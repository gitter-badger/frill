<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">test/api/v1/postsTest.js | FrillJS API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/nanopx/frill" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/components/App/index.jsx~AppComponent.html">AppComponent</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/actions/Auth.js~AuthAction.html">AuthAction</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/stores/Auth.js~AuthStore.html">AuthStore</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/components/Error.jsx~ErrorComponent.html">ErrorComponent</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/actions/Example.js~ExampleAction.html">ExampleAction</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/stores/Example.js~ExampleStore.html">ExampleStore</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/components/Login/index.jsx~LoginComponent.html">LoginComponent</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/components/Page.jsx~PageComponent.html">PageComponent</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/components/ScrollBlock/index.jsx~ScrollBlockComponent.html">ScrollBlockComponent</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/components/Top/index.jsx~TopComponent.html">TopComponent</a></span></li>
</ul>
</div>





<div data-ice="variableWrap">
  <h2><a href="variable/">Variable</a></h2>
  <ul>
    
  <li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-Actions">Actions</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-Components">Components</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-FrillCore">FrillCore</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-Models">Models</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-Stores">Stores</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-Strategies">Strategies</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-api">api</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-apiV1">apiV1</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-apiV1Hello">apiV1Hello</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-appComponent">appComponent</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-authAction">authAction</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-authHandlers">authHandlers</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-authRoutes">authRoutes</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-authStore">authStore</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-componentRoutes">componentRoutes</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-errorComponent">errorComponent</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-exampleAction">exampleAction</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-exampleStore">exampleStore</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-facebookStrategy">facebookStrategy</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-githubStrategy">githubStrategy</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-googleStrategy">googleStrategy</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-helpers">helpers</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-jwtStrategy">jwtStrategy</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-localAuthRoutes">localAuthRoutes</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-localAuthRoutes">localAuthRoutes</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-localStrategy">localStrategy</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-loginComponent">loginComponent</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-pageComponent">pageComponent</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-posts">posts</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-posts">posts</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-routePrefixer">routePrefixer</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-routerContainer">routerContainer</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-routes">routes</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-scrollBlockComponent">scrollBlockComponent</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-topComponent">topComponent</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-twitterAuthRoutes">twitterAuthRoutes</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-twitterStrategy">twitterStrategy</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-users">users</a></span></li>
</ul>
</div>



<div data-ice="externalWrap">
  <h2>External</h2>
  <ul>
    
  <li data-ice="externalDoc"><span><a href="http://aws.amazon.com/">AmazonWebServices</a></span></li>
<li data-ice="externalDoc"><span><a href="http://docs.sequelizejs.com/en/latest">Sequelize</a></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">test/api/v1/postsTest.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">import posts from &apos;../../../src/api/v1/posts&apos;;
import {inject, convertToPlainObject} from &apos;../../frillHelper&apos;;
import {routePrefixer} from &apos;../../../src/helpers&apos;;
import sequelize from &apos;../../../src/models/setup_sequelize&apos;;
import Models from &apos;../../../src/models&apos;;

server.route(routePrefixer(&apos;/api/v1&apos;, posts(server, Models)));

const testData = [
  {
    title: &apos;testOne&apos;,
    content: &apos;this is a content for testOne, for testing purpose&apos;,
  },
  {
    title: &apos;testTwo&apos;,
    content: &apos;this is a content for testTwo, for testing purpose&apos;,
  },
];

describe(&apos;/api/v1/posts&apos;, () =&gt; {
  before((done) =&gt; {
    if (process.env.NODE_ENV !== &apos;test&apos;) {
      throw new Error(
        &apos;Please set NODE_ENV to \&apos;test\&apos; to ensure your data will not&apos;
        + &apos; be modified or deleted by tests.&apos;
      );
    } else {
      // force sync sequelize before running tests
      sequelize.sync({force: true}).then(() =&gt; {
        Models.mysql.Posts.bulkCreate(testData);
      }).finally(done);
    }
  });

  after((done) =&gt; {
    if (process.env.NODE_ENV !== &apos;test&apos;) {
      throw new Error(
        &apos;Please set NODE_ENV to \&apos;test\&apos; to ensure your data will not&apos;
        + &apos; be modified or deleted by tests.&apos;
      );
    } else {
      // drop
      sequelize.drop({force: true}).finally(done);
    }
  });

  describe(&apos;GET /&apos;, () =&gt; {
    it(&apos;should return 200 and fetch results on GET request&apos;, () =&gt; {
      return inject({ method: &apos;GET&apos;, url: &apos;/api/v1/posts&apos; })
      .then((response) =&gt; {
        response.statusCode.should.equal(200);
        return convertToPlainObject(response.result).then((result) =&gt; {
          result.should.have.length(2);
        });
      });
    });
  });

  describe(&apos;GET /{id}&apos;, () =&gt; {
    it(&apos;should return 200 and fetch a result on GET request&apos;, () =&gt; {
      return inject({ method: &apos;GET&apos;, url: &apos;/api/v1/posts/1&apos; })
      .then((response) =&gt; {
        response.statusCode.should.equal(200);
        return convertToPlainObject(response.result).then((result) =&gt; {
          result.should.have.ownProperty(&apos;id&apos;);
          result.id.should.equal(1);
        });
      });
    });
  });

  describe(&apos;POST /&apos;, () =&gt; {
    it(&apos;should return 201 on POST request&apos;, () =&gt; {
      return inject({
        method: &apos;POST&apos;,
        url: &apos;/api/v1/posts&apos;,
        payload: {
          title: &apos;a new test title&apos;,
          content: &apos;a new test content&apos;,
        },
      })
      .then((response) =&gt; {
        response.statusCode.should.equal(201);
      });
    });
    it(&apos;should have new record created&apos;, () =&gt; {
      return inject({
        method: &apos;GET&apos;,
        url: &apos;/api/v1/posts/3&apos;,
      })
      .then((response) =&gt; {
        response.statusCode.should.equal(200);
        return convertToPlainObject(response.result).then((result) =&gt; {
          result.should.have.ownProperty(&apos;id&apos;);
          result.id.should.equal(3);
          result.should.have.ownProperty(&apos;title&apos;);
          result.title.should.equal(&apos;a new test title&apos;);
        });
      });
    });
  });

  describe(&apos;PUT /{id}&apos;, () =&gt; {
    it(&apos;should be able to modify record&apos;, () =&gt; {
      return inject({
        method: &apos;PUT&apos;,
        url: &apos;/api/v1/posts/3&apos;,
        payload: {
          title: &apos;a new test title - modified&apos;,
        },
      })
      .then((response) =&gt; {
        response.statusCode.should.equal(200);
        return convertToPlainObject(response.result).then((result) =&gt; {
          result[0].should.equal(1); // rows affected
        });
      });
    });
    it(&apos;should have record modified&apos;, () =&gt; {
      return inject({
        method: &apos;GET&apos;,
        url: &apos;/api/v1/posts/3&apos;,
      })
      .then((response) =&gt; {
        response.statusCode.should.equal(200);
        return convertToPlainObject(response.result).then((result) =&gt; {
          result.should.have.ownProperty(&apos;id&apos;);
          result.id.should.equal(3);
          result.should.have.ownProperty(&apos;title&apos;);
          result.title.should.equal(&apos;a new test title - modified&apos;);
        });
      });
    });
  });

  describe(&apos;DELETE /{id}&apos;, () =&gt; {
    it(&apos;should be able to delete record&apos;, () =&gt; {
      return inject({
        method: &apos;DELETE&apos;,
        url: &apos;/api/v1/posts/3&apos;,
      })
      .then((response) =&gt; {
        response.statusCode.should.equal(204);
      });
    });
    it(&apos;should be deleted&apos;, () =&gt; {
      return inject({
        method: &apos;GET&apos;,
        url: &apos;/api/v1/posts/3&apos;,
      })
      .then((response) =&gt; {
        response.statusCode.should.equal(404);
      });
    });
  });
});
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.2.1)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
